<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SIPAI SAMAJ TRUST - Receipt Entry</title>
<style>


    body {
        font-family: Arial, sans-serif;
        background-color: #f7f9fc;
        margin: 0;
        padding: 20px;
    }
    .container {
        max-width: 900px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
        text-align: center;
        margin-bottom: 5px;
        color: #003366;
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 16px;
        color: #666;
    }
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 12px;
        flex-wrap: wrap;
    }
    .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    label {
        margin-bottom: 4px;
        color: #333;
        font-size: 14px;
    }
    input, textarea {
        padding: 6px 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
    }
    input.small-input {
        width: 180px;
    }
    textarea {
        resize: vertical;
    }
    .readonly {
        background-color: #f1f1f1;
    }
    .section-title {
        font-weight: bold;
        margin-top: 18px;
        padding: 8px;
        background: #e8eef7;
        border-radius: 8px;
        font-size: 15px;
    }
    /* Fund row styling - compact */
    .fund-row {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
    }
    .fund-row label {
        margin: 0;
        font-size: 14px;
        min-width: 160px; /* fixed width for label */
    }
    .fund-input {
        width: 150px;
    }
    .button-group {
        text-align: center;
        margin-top: 20px;
    }
    .btn {
        padding: 10px 20px;
        font-size: 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 0 5px;
    }
    .btn-save {
        background-color: #28a745;
        color: white;
    }
    .btn-clear {
        background-color: #dc3545;
        color: white;
    }
    .btn:hover {
        opacity: 0.9;
    }
	
	#toast {
		max-width: 80vw; /* Shrinks for small screens */
		font-size: 13px; /* Slightly smaller text */
	}

	#overlay {
		text-align: center;
		padding: 20px; /* Better text spacing */
	}

</style>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://graceful-zuccutto-12eda0.netlify.app//SYG_DONATION_RECEIPT.js"></script>
</head>
<body>

<div class="container">
    <h1>SIPAI SAMAJ TRUST</h1>
    <h2>Receipt Entry Form</h2>

    <!-- Receipt Number & Date -->
    <div class="form-row">
        <div class="form-group">
            <label>Receipt Number</label>
            <input type="text" id="receiptNumber" class="small-input" required>
        </div>
        <div class="form-group">
            <label>Date</label>
            <input type="date" id="date" class="small-input" required>
        </div>
    </div>

    <!-- Name -->
    <div class="form-row">
        <div class="form-group">
            <label>Name</label>
            <input type="text" id="name" required>
        </div>
    </div>

    <!-- Address -->
    <div class="form-row">
        <div class="form-group">
            <label>Address</label>
            <textarea id="address" rows="2" required></textarea>
        </div>
    </div>

    <!-- Mobile -->
    <div class="form-row">
        <div class="form-group">
            <label>Mobile</label>
            <input type="tel" id="mobile" class="small-input" required>
        </div>
    </div>

    <!-- City & Pincode -->
    <div class="form-row">
        <div class="form-group">
            <label>City</label>
            <input type="text" id="city" class="small-input" required>
        </div>
        <div class="form-group">
            <label>Pincode</label>
            <input type="text" id="pincode" class="small-input" required>
        </div>
    </div>

    <!-- District & Taluka -->
    <div class="form-row">
        <div class="form-group">
            <label>District</label>
            <input type="text" id="district" class="small-input" required>
        </div>
        <div class="form-group">
            <label>Taluka</label>
            <input type="text" id="taluka" class="small-input" required>
        </div>
    </div>

    <!-- Fund Details -->
    <div class="section-title">Fund Details (Optional)</div>

    <div class="fund-row">
        <label>Membership Fee</label>
        <input type="number" id="membershipFee" class="fund-input" oninput="calculateTotal()">
    </div>
    <div class="fund-row">
        <label>Donation</label>
        <input type="number" id="donation" class="fund-input" oninput="calculateTotal()">
    </div>
    <div class="fund-row">
        <label>Zakat Fund</label>
        <input type="number" id="zakatFund" class="fund-input" oninput="calculateTotal()">
    </div>
    <div class="fund-row">
        <label>Education Fund</label>
        <input type="number" id="educationFund" class="fund-input" oninput="calculateTotal()">
    </div>
    <div class="fund-row">
        <label>Marriage Bureau Fund</label>
        <input type="number" id="marriageFund" class="fund-input" oninput="calculateTotal()">
    </div>
    <div class="fund-row">
        <label>Widow Help Fund</label>
        <input type="number" id="widowFund" class="fund-input" oninput="calculateTotal()">
    </div>

    <!-- Total -->
    <div class="form-row">
        <div class="form-group">
            <label>Total</label>
            <input type="text" id="total" class="readonly small-input" readonly>
        </div>
        <div class="form-group">
            <label>Total in Words</label>
            <input type="text" id="totalWords" class="readonly" readonly>
        </div>
    </div>

    <!-- Payment -->
    <div class="form-row">
        <div class="form-group">
            <label>UPI / Cheque Details</label>
            <textarea id="paymentDetails" rows="2"></textarea>
        </div>
    </div>

    <!-- Buttons -->
    <div class="button-group">
        <button class="btn btn-save" onclick="saveReceipt()">üíæ Save Receipt</button>
        <button class="btn btn-clear" onclick="clearForm()">üóëÔ∏è Clear Form</button>
    </div>
</div>

<div id="toast" style="
  visibility: hidden;
  min-width: 250px;
  background: #333;
  color: #fff;
  text-align: center;
  border-radius: 5px;
  padding: 12px;
  position: fixed;
  z-index: 10000;
  bottom: 20px;
  right: 20px;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.5s, visibility 0.5s;"></div>
  
  <div id="overlay" style="
	  position: fixed;
	  display: none;
	  width: 100%;
	  height: 100%;
	  top: 0; left: 0;
	  background: rgba(0,0,0,0.6);
	  z-index: 9999;
	  justify-content: center;
	  align-items: center;
	  color: white;
	  font-size: 20px;">
  Processing... Please wait
</div>





<script>

let data= null;

function calculateTotal() {
    let fields = ["membershipFee", "donation", "zakatFund", "educationFund", "marriageFund", "widowFund"];
    let total = 0;
    fields.forEach(id => {
        let value = parseFloat(document.getElementById(id).value) || 0;
        total += value;
    });
    document.getElementById("total").value = total.toFixed(2);
    document.getElementById("totalWords").value = numberToWords(total);
}

/*
function numberToWords(num) {
    if (num === 0) return "Zero";
    let a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 
             'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
    let b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

    function inWords(n) {
        if (n < 20) return a[n];
        if (n < 100) return b[Math.floor(n / 10)] + (n % 10 ? " " + a[n % 10] : "");
        if (n < 1000) return a[Math.floor(n / 100)] + " Hundred" + (n % 100 ? " " + inWords(n % 100) : "");
        if (n < 100000) return inWords(Math.floor(n / 1000)) + " Thousand" + (n % 1000 ? " " + inWords(n % 1000) : "");
        if (n < 10000000) return inWords(Math.floor(n / 100000)) + " Lakh" + (n % 100000 ? " " + inWords(n % 100000) : "");
        return inWords(Math.floor(n / 10000000)) + " Crore" + (n % 10000000 ? " " + inWords(n % 10000000) : "");
    }
    return inWords(Math.floor(num));
}
*/

function saveReceipt() {
	
    let requiredFields = document.querySelectorAll("input[required], textarea[required]");
    for (let field of requiredFields) {
        if (!field.value.trim()) {
            alert("‚ö†Ô∏è Please fill all required fields.");
            field.focus();
            return;
        }
    }
	
	
		try {
			showOverlay();
			
			  data = {
				receiptNumber: document.getElementById("receiptNumber").value,
				date: document.getElementById("date").value,
				name: document.getElementById("name").value,
				address: document.getElementById("address").value,
				mobile: document.getElementById("mobile").value,
				city: document.getElementById("city").value,
				pincode: document.getElementById("pincode").value,
				district: document.getElementById("district").value,
				taluka: document.getElementById("taluka").value,
				membershipFee: document.getElementById("membershipFee").value || 0,
				donation: document.getElementById("donation").value || 0,
				zakatFund: document.getElementById("zakatFund").value || 0,
				educationFund: document.getElementById("educationFund").value || 0,
				marriageFund: document.getElementById("marriageFund").value || 0,
				widowFund: document.getElementById("widowFund").value || 0,
				total: document.getElementById("total").value,
				totalWords: document.getElementById("totalWords").value,
				paymentDetails: document.getElementById("paymentDetails").value
    };
	
			
			saveDataOnCloud();
			createReceiptPDF();
			
		} catch (err) {
			showToast("‚ùå " + err.message, "red");
		} finally {			
			showToast("‚úÖ Receipt downloaded successfully!" , "green");
			hideOverlay();
		}
	
  

     

}

function saveDataOnCloud()
{
		   
	console.log(data);
	console.log(JSON.stringify(data));	
	
	fetch("https://script.google.com/macros/s/AKfycbzHI5w1HjVaqesHG1D2GqvseEFMtTR6UiWXwy0fdJGSTUF4p5LnlpVLSKh4FUL9mw7r/exec", { 	
        method: "POST",
        mode: "no-cors",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
    }).then(() => {
        alert("‚úÖ Receipt saved successfully to Google Sheet! Generating PDF.......");
		showToast('‚úÖ Receipt saved successfully to cloud! Generating PDF.......', 'green')
		
		createReceiptPDF()
		
        clearForm();
    }).catch(err => {		
        showToast("‚ùå Error saving data: " + err, 'red');
    });
}

function clearForm() {
    document.querySelectorAll("input, textarea").forEach(el => {
        if (el.type !== "date" && !el.readOnly) el.value = "";
    });
    document.getElementById("total").value = "";
    document.getElementById("totalWords").value = "";
}

</script>

</body>
</html>
